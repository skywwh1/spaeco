/*!
 * AjaxDropDown v1.3.2 | Pawel Bizley Brzozowski | https://github.com/bizley-code/Yii2-AjaxDropDown
 */
!function(a){a.fn.ajaxDropDown=function(e){var n=a.extend(!0,{addc:"",dely:300,ercl:"",erst:"",hecl:"",hest:"",jsev:!0,keyt:!0,locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",onrm:"",onsl:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smbt:!1,smod:!1,swcl:"",swst:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},e),t="active",r=" ajaxDropDownRecord",s="</a></li>",l="a.ajaxDropDownNext",o="a.ajaxDropDownPrev",i="button.ajaxDropDownSingleRemove",d="button.ajaxDropDownToggle",p='><a href="#" class="ajaxDropDownResult" data-id="',c="disabled",f="hidden",v="input[type=text]",m="</li>",u='<li class="dropdown-header',g="li.ajaxDropDownPage",h="li.ajaxDropDownPages",D='<li class="ajaxDropDownPages ajaxDropDownPage',w="li.ajaxDropDownSelected",j="span.ajaxDropDownPageNumber",x=' style="',b="ul.ajaxDropDownMenu",y=null,C=[],R=new Function("id","selection",n.onrm),N=new Function("id","label","selection",n.onsl),k=function(a){var e=[];for(var n in C)C[n].id!=a&&e.push(C[n]);C=e},P=function(a){for(var e in C)if(C[e].id==a)return!0;return!1},S=this.find("ul.ajaxDropDownResults"),T=this.find(i),q=this.find(b),I=this.find(v),A=this.find(d),L=this.find("div.ajaxDropDownButtons"),U='<li class="ajaxDropDownLoading';""!==n.locl&&(U+=" "+n.locl),U+='"',""!==n.lost&&(U+=x+n.lost+'"'),U+=">"+n.prba+m;var E=u;""!==n.hecl&&(E+=" "+n.hecl),E+='"',""!==n.hest&&(E+=x+n.hest+'"'),E+=">";var M=n.loca.mcha.replace(/{NUM}/g,n.minq),O=u;""!==n.ercl&&(O+=" "+n.ercl),O+='"',""!==n.erst&&(O+=x+n.erst+'"'),O+=">"+n.loca.erro+m;var Q=u;""!==n.nrcl&&(Q+=" "+n.nrcl),Q+='"',""!==n.nrst&&(Q+=x+n.nrst+'"'),Q+=">"+n.loca.nrec+m;var F=function(){if(0===q.find(h).length){var e=A.data("page");e=1*e;var l=!1,o=E+n.pabe+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>',i=o;i+=n.paen+n.loca.allr+'</li><li class="divider"></li>'+U;var d=I.val();d.length>0?d.length>=n.minq?(i=o,i+=n.paen+n.loca.rcon+" <strong>"+d,i+='</strong></li><li class="divider"></li>'+U,l=!0):i=E+M+m:l=!0,q.html(i),l&&a.post(n.url,{query:d,page:e}).fail(function(){q.append(O),console.log("jQuery post failed")}).done(function(e){var l=a.parseJSON(e);if(void 0===l.total&&(l.total=1),void 0===l.page&&(l.page=1),void 0===l.data)q.append(O),console.log("No data element in results object",e);else if(l.data.length){q.find("span.ajaxDropDownTotalPages").text(l.total);for(var o in l.data){var i=D+l.page+r+l.data[o].id;""!==n.recl&&(i+=" "+n.recl),q.parent().parent().parent().find(w+l.data[o].id).length&&(i+=" "+t),i+='"',""!==n.rest&&(i+=x+n.rest+'"'),i+=p+l.data[o].id+'">',l.data[o].mark&&(i+=n.mabe),i+=l.data[o].value,l.data[o].mark&&(i+=n.maen),i+=s,q.append(i)}if(l.total>1){var d='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==n.swcl&&(d+=" "+n.swcl),d+='"',""!==n.swst&&(d+=x+n.swst+'"'),d+='><a href="#" class="ajaxDropDownPrev',""!==n.prcl&&(d+=" "+n.prcl),1===l.page&&(d+=" "+c),d+='"',""!==n.prst&&(d+=x+n.prst+'"'),d+=">"+n.prbe+n.loca.prev+n.pren+'</a><a href="#" class="ajaxDropDownNext',""!==n.necl&&(d+=" "+n.necl),l.page===l.total&&(d+=" "+c),d+='"',""!==n.nest&&(d+=x+n.nest+'"'),d+=">"+n.nebe+n.loca.next+n.neen+s,q.append(d)}}else q.append(Q)}).always(function(){a("li.ajaxDropDownLoading").remove()})}};return this.on("show.bs.dropdown",F),this.on("click",l,function(e){e.preventDefault(),e.stopPropagation(),q.find(o).removeClass(c),q.find(l).addClass(c);var i=A.data("page");if(i=1*i+1,q.find(g+i).length)q.find(h).addClass(f),q.find(g+i).removeClass(f),q.find(l).removeClass(c);else{var d=I.val();a.post(n.url,{query:d,page:i}).fail(function(){q.append(O),console.log("jQuery post failed")}).done(function(e){var o=a.parseJSON(e);if(void 0===o.data)q.append(O),console.log("No data element in results object",e);else if(o.data.length){q.find(h).addClass(f),void 0===o.total&&(o.total=1),void 0===o.page&&(o.page=1);for(var d in o.data){var v=D+o.page+r+o.data[d].id;""!==n.recl&&(v+=" "+n.recl),q.parent().parent().parent().find(w+o.data[d].id).length&&(v+=" "+t),v+='"',""!==n.rest&&(v+=x+n.rest+'"'),v+=p+o.data[d].id+'">',o.data[d].mark&&(v+=n.mabe),v+=o.data[d].value,o.data[d].mark&&(v+=n.maen),v+=s,q.find(".divider.ajaxDropDownInfo").before(v)}o.page<o.total?q.find(l).removeClass(c):i=o.total}else q.append(Q)})}A.data("page",i),q.find(j).text(i)}),this.on("click",o,function(a){a.preventDefault(),a.stopPropagation(),q.find(l).removeClass(c),q.find(o).addClass(c);var e=A.data("page");e=1*e-1,1>e&&(e=1),q.find(h).addClass(f),q.find(g+e).removeClass(f),e>1&&q.find(o).removeClass(c),A.data("page",e),q.find(j).text(e)}),this.on("keyup",v,function(){window.clearTimeout(y),a(this).parent().find(d).data("page",1),a(this).parent().find(b).find(h).remove(),n.keyt&&(y=window.setTimeout(function(){L.addClass("open"),F()},n.dely))}),this.on("click","a.ajaxDropDownResult",function(e){e.preventDefault();var r=a(this).data("id"),s=a(this).html(),l="[]";if(n.smod&&(S.html(""),C=[],a(this).parent().parent().find(h).removeClass(t),l=""),n.smod&&""===n.addc&&!n.smbt)A.hide(),T.show(),I.val(s.replace(/<.*?>/g,"").replace(/"/g,"'")),I.prop("disabled",!0),I.parent().find(".singleResult").length?I.parent().find(".singleResult").val(r):I.after('<input class="singleResult" type="hidden" name="'+n.name+'" value="'+r+'">'),C.push({id:r,label:s}),N(r,s,C);else if(a(this).parent().hasClass(t))a(this).parent().removeClass(t),S.find(w+r).remove(),k(r),R(r,C);else{a(this).parent().addClass(t);var o='<li class="ajaxDropDownSelected'+r;if(""!==n.rscl&&(o+=" "+n.rscl),o+='"',""!==n.rsst&&(o+=x+n.rsst+'"'),o+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(o+=" "+n.rmcl),o+='"',""!==n.rmst&&(o+=x+n.rmst+'"'),o+=' data-id="'+r+'">'+n.rmla+"</a>",""!==n.addc){var i=n.addc.replace(/{ID}/g,r);i=i.replace(/{VALUE}/g,s),o+=i}o+=s+'<input type="hidden" name="'+n.name+l+'" value="'+r+'"></li>',S.append(o),C.push({id:r,label:s}),N(r,s,C)}}),this.on("click","a.ajaxDropDownRemove",function(e){e.preventDefault();var n=a(this).data("id");a(this).parent().parent().parent().find("li.ajaxDropDownRecord"+n).removeClass(t),a(this).parent().remove(),k(n),R(n,C)}),this.on("click",i,function(e){e.preventDefault();var n=a(this).parent().parent().find("input.singleResult"),t=n.val();n.remove(),I.prop("disabled",!1),I.val(""),a(this).hide(),A.show(),k(t),R(t,C)}),this.on("add",function(){var a="[]",e="";n.smod&&(S.html(""),C=[],a="");for(var t in arguments)if(0!=t)if(void 0===arguments[t].id)console.log("No id element in data object",arguments[t]);else{var r=arguments[t].id;if(!P(r)){var s="";void 0!==arguments[t].value&&(s=arguments[t].value);var l=0;1==arguments[t].mark&&(l=1),l&&(s=n.mabe+s+n.maen);var o=n.addc;if(arguments[t].additional===!1?o="":void 0!==arguments[t].additional&&(o=arguments[t].additional),n.smod&&""===n.addc&&!n.smbt)A.hide(),T.show(),I.val(s.replace(/<.*?>/g,"").replace(/"/g,"'")),I.prop("disabled",!0),I.parent().find(".singleResult").length?I.parent().find(".singleResult").val(r):I.after('<input class="singleResult" type="hidden" name="'+n.name+'" value="'+r+'">'),C.push({id:r,label:s}),n.jsev&&N(r,s,C);else{var e='<li class="ajaxDropDownSelected'+r;if(""!==n.rscl&&(e+=" "+n.rscl),e+='"',""!==n.rsst&&(e+=x+n.rsst+'"'),e+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(e+=" "+n.rmcl),e+='"',""!==n.rmst&&(e+=x+n.rmst+'"'),e+=' data-id="'+r+'">'+n.rmla+"</a>",""!==o){var i=o.replace(/{ID}/g,r);i=i.replace(/{VALUE}/g,s),e+=i}e+=s+'<input type="hidden" name="'+n.name+a+'" value="'+r+'"></li>',n.smbt||(S.append(e),C.push({id:r,label:s}),n.jsev&&N(r,s,C))}}}n.smbt&&""!==e&&(S.append(e),C.push({id:r,label:s}),n.jsev&&N(r,s,C))}),this.on("removeOne",function(){for(var a in arguments)if(0!=a)if(isNaN(arguments[a]))console.log("id is not a number",arguments[a]);else{var e=arguments[a];P(e)&&(S.find(w+e).remove(),k(e),n.jsev&&R(e,C))}}),this.on("removeAll",function(){S.html(""),C=[]}),this}}(jQuery);